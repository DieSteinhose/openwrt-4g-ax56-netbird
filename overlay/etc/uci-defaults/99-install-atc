#!/bin/sh
set -e

# 99-install-atc: install bundled ATC packages from /root/atc
# If luci-proto-atc is already installed, skip.

if apk info -e luci-proto-atc >/dev/null 2>&1; then
    exit 0
fi

DIR=/root/atc
[ -d "$DIR" ] || exit 0

set --
for pkg in "$DIR"/*.apk; do
    [ -f "$pkg" ] || continue
    set -- "$@" "$pkg"
done

[ "$#" -gt 0 ] || exit 0

# Install all found package files in one apk invocation.
apk add --allow-untrusted --no-network "$@" && reboot

exit 0