#!/bin/sh
set -e

# Install pre-bundled ATC packages from /root/atc only when luci-proto-atc is missing
if ! apk info -e luci-proto-atc >/dev/null 2>&1; then
    DIR=/root/atc
    if [ -d "$DIR" ]; then
        set --
        for pkg in "$DIR"/*.apk; do
            [ -f "$pkg" ] || continue
            set -- "$@" "$pkg"
        done
        if [ "$#" -gt 0 ]; then
            apk add --allow-untrusted --no-network "$@"
            reboot
        fi
    fi
fi

exit 0